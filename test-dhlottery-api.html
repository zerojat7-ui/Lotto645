<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë™í–‰ë³µê¶Œ API í…ŒìŠ¤íŠ¸</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    h1 {
      color: #667eea;
      margin-bottom: 20px;
      text-align: center;
      font-size: 24px;
    }
    .test-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .test-title {
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    input {
      flex: 1;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }
    button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #5568d3; }
    button:active { transform: scale(0.98); }
    button.secondary {
      background: #00C49F;
    }
    .result-box {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
      color: #00ff88;
      font-family: monospace;
      font-size: 12px;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .result-box.error {
      color: #ff6b6b;
    }
    .lotto-ball {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-weight: bold;
      font-size: 16px;
      margin: 3px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .lotto-ball.r1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #222; }
    .lotto-ball.r2 { background: linear-gradient(135deg, #4dabf7, #1971c2); color: white; }
    .lotto-ball.r3 { background: linear-gradient(135deg, #ff6b6b, #c92a2a); color: white; }
    .lotto-ball.r4 { background: linear-gradient(135deg, #495057, #212529); color: white; }
    .lotto-ball.r5 { background: linear-gradient(135deg, #51cf66, #2f9e44); color: white; }
    .lotto-ball.bonus { box-shadow: 0 0 0 3px #333, 0 2px 5px rgba(0,0,0,0.2); }
    .balls-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 8px;
    }
    .status {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      margin-bottom: 10px;
      font-weight: 500;
    }
    .status.loading { background: #fff3cd; color: #856404; }
    .status.success { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 10px 0;
    }
    .info-item {
      background: white;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }
    .info-label {
      font-size: 11px;
      color: #666;
      margin-bottom: 4px;
    }
    .info-value {
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
    }
    .cors-warning {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 13px;
      color: #856404;
    }
    .cors-warning strong {
      display: block;
      margin-bottom: 5px;
      color: #d39e00;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ° ë™í–‰ë³µê¶Œ API í…ŒìŠ¤íŠ¸</h1>

    <div class="cors-warning">
      <strong>âš ï¸ CORS ì œí•œ ì•ˆë‚´</strong>
      ë™í–‰ë³µê¶Œ APIëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í˜¸ì¶œ ì‹œ CORS ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ í”„ë¡ì‹œë¥¼ í†µí•´ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.
    </div>

    <!-- ìµœì‹  íšŒì°¨ ì¡°íšŒ -->
    <div class="test-section">
      <div class="test-title">ğŸ“¡ 1. ìµœì‹  íšŒì°¨ ì¡°íšŒ</div>
      <button onclick="fetchLatest()">ìµœì‹  ë‹¹ì²¨ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°</button>
      <div id="latestStatus"></div>
      <div id="latestResult"></div>
    </div>

    <!-- íŠ¹ì • íšŒì°¨ ì¡°íšŒ -->
    <div class="test-section">
      <div class="test-title">ğŸ” 2. íŠ¹ì • íšŒì°¨ ì¡°íšŒ</div>
      <div class="input-group">
        <input type="number" id="roundInput" placeholder="íšŒì°¨ ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 1148)" value="1148">
        <button onclick="fetchRound()">ì¡°íšŒ</button>
      </div>
      <div id="roundStatus"></div>
      <div id="roundResult"></div>
    </div>

    <!-- ì—°ì† ì¡°íšŒ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <div class="test-title">ğŸ”„ 3. ì—°ì† ì¡°íšŒ í…ŒìŠ¤íŠ¸ (Rate Limit í™•ì¸)</div>
      <div class="input-group">
        <input type="number" id="batchStart" placeholder="ì‹œì‘ íšŒì°¨" value="1145">
        <input type="number" id="batchEnd" placeholder="ë íšŒì°¨" value="1148">
        <button class="secondary" onclick="fetchBatch()">ì¼ê´„ ì¡°íšŒ</button>
      </div>
      <div id="batchStatus"></div>
      <div id="batchResult"></div>
    </div>

    <!-- API ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ -->
    <div class="test-section">
      <div class="test-title">ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸</div>
      <div style="font-size: 12px; color: #666; line-height: 1.8;">
        <strong>ìµœì‹  íšŒì°¨:</strong><br>
        GET https://dhlottery.co.kr/common.do?method=main<br>
        (HTML íŒŒì‹±í•˜ì—¬ íšŒì°¨ ì¶”ì¶œ)<br><br>
        
        <strong>ë‹¹ì²¨ ë²ˆí˜¸:</strong><br>
        GET https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo={íšŒì°¨}<br><br>
        
        <strong>ì‘ë‹µ í•„ë“œ:</strong><br>
        - returnValue: "success" / "fail"<br>
        - drwNo: íšŒì°¨ ë²ˆí˜¸<br>
        - drwNoDate: ì¶”ì²¨ ë‚ ì§œ<br>
        - drwtNo1~6: ë‹¹ì²¨ ë²ˆí˜¸<br>
        - bnusNo: ë³´ë„ˆìŠ¤ ë²ˆí˜¸<br>
        - totSellamnt: ì´ íŒë§¤ì•¡<br>
        - firstWinamnt: 1ë“± ë‹¹ì²¨ê¸ˆ
      </div>
    </div>
  </div>

<script>
// â•â• ê³µ ë²”ìœ„ í´ë˜ìŠ¤ â•â•
function ballClass(n) {
  if (n <= 10) return 'r1';
  if (n <= 20) return 'r2';
  if (n <= 30) return 'r3';
  if (n <= 40) return 'r4';
  return 'r5';
}

// â•â• ê³µ HTML ìƒì„± â•â•
function createBall(n, isBonus) {
  return `<div class="lotto-ball ${ballClass(n)}${isBonus ? ' bonus' : ''}">${n}</div>`;
}

// â•â• 1. ìµœì‹  íšŒì°¨ ì¡°íšŒ â•â•
async function fetchLatest() {
  const statusEl = document.getElementById('latestStatus');
  const resultEl = document.getElementById('latestResult');
  
  statusEl.innerHTML = '<div class="status loading">â³ ìµœì‹  íšŒì°¨ ì¡°íšŒ ì¤‘...</div>';
  resultEl.innerHTML = '';

  try {
    // STEP 1: ë©”ì¸ í˜ì´ì§€ì—ì„œ ìµœì‹  íšŒì°¨ ì¶”ì¶œ
    statusEl.innerHTML = '<div class="status loading">â³ ë©”ì¸ í˜ì´ì§€ íŒŒì‹± ì¤‘...</div>';
    const mainResp = await fetch('https://dhlottery.co.kr/common.do?method=main', {
      mode: 'cors',
      headers: {
        'User-Agent': 'Mozilla/5.0'
      }
    });
    
    if (!mainResp.ok) throw new Error('ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨: ' + mainResp.status);
    
    const html = await mainResp.text();
    const match = html.match(/<strong id="lottoDrwNo">(\d+)<\/strong>/);
    
    if (!match) throw new Error('íšŒì°¨ ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    
    const latestRound = parseInt(match[1]);
    
    // STEP 2: ë‹¹ì²¨ ë²ˆí˜¸ ì¡°íšŒ
    statusEl.innerHTML = `<div class="status loading">â³ ${latestRound}íšŒì°¨ ë‹¹ì²¨ ë²ˆí˜¸ ì¡°íšŒ ì¤‘...</div>`;
    
    const dataResp = await fetch(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${latestRound}`, {
      mode: 'cors'
    });
    
    if (!dataResp.ok) throw new Error('ë‹¹ì²¨ ë²ˆí˜¸ ì¡°íšŒ ì‹¤íŒ¨: ' + dataResp.status);
    
    const data = await dataResp.json();
    
    if (data.returnValue !== 'success') {
      throw new Error('API ì‘ë‹µ ì‹¤íŒ¨: ' + JSON.stringify(data));
    }
    
    // ì„±ê³µ!
    statusEl.innerHTML = '<div class="status success">âœ… ì¡°íšŒ ì„±ê³µ!</div>';
    
    const numbers = [data.drwtNo1, data.drwtNo2, data.drwtNo3, data.drwtNo4, data.drwtNo5, data.drwtNo6];
    const bonus = data.bnusNo;
    
    resultEl.innerHTML = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">íšŒì°¨</div>
          <div class="info-value">${data.drwNo}íšŒ</div>
        </div>
        <div class="info-item">
          <div class="info-label">ì¶”ì²¨ì¼</div>
          <div class="info-value">${data.drwNoDate}</div>
        </div>
      </div>
      <div class="balls-container">
        ${numbers.map(n => createBall(n, false)).join('')}
        <div style="margin: 0 5px; font-size: 20px; color: #999;">+</div>
        ${createBall(bonus, true)}
      </div>
      <div class="result-box">
${JSON.stringify(data, null, 2)}
      </div>
    `;
    
  } catch(error) {
    statusEl.innerHTML = '<div class="status error">âŒ ì˜¤ë¥˜ ë°œìƒ</div>';
    resultEl.innerHTML = `<div class="result-box error">
âš ï¸ CORS ì—ëŸ¬ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜

ì—ëŸ¬ ë©”ì‹œì§€: ${error.message}

ë™í–‰ë³µê¶Œ APIëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í˜¸ì¶œ ì‹œ CORS ì •ì±…ìœ¼ë¡œ ì¸í•´
ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ê²° ë°©ë²•:
1. ì„œë²„ í”„ë¡ì‹œ ì‚¬ìš© (ê¶Œì¥)
2. CORS Proxy ì„œë¹„ìŠ¤ ì‚¬ìš©
3. ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ ì‚¬ìš© (ê°œë°œ í…ŒìŠ¤íŠ¸ìš©)
4. Firebase Functions ë“± ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ ì‚¬ìš©

ì‹¤ì œ ì•±ì—ì„œëŠ” ì•„ë˜ Python ì½”ë“œì²˜ëŸ¼ ì„œë²„ì—ì„œ í˜¸ì¶œí•˜ì„¸ìš”:

import requests

def get_lotto_winning_number(round_num=None):
    if round_num is None:
        # ìµœì‹  íšŒì°¨ ì¡°íšŒ
        main_page = requests.get("https://dhlottery.co.kr/common.do?method=main").text
        latest_draw = int(main_page.split('<strong id="lottoDrwNo">')[1].split('</strong>')[0])
        round_num = latest_draw
    
    # ë‹¹ì²¨ ë²ˆí˜¸ ì¡°íšŒ
    response = requests.get(f"https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo={round_num}")
    data = response.json()
    
    if data["returnValue"] == "success":
        return {
            "draw_no": data["drwNo"],
            "draw_date": data["drwNoDate"],
            "numbers": [data[f"drwtNo{i}"] for i in range(1, 7)],
            "bonus": data["bnusNo"]
        }
    return None
    </div>`;
  }
}

// â•â• 2. íŠ¹ì • íšŒì°¨ ì¡°íšŒ â•â•
async function fetchRound() {
  const roundNum = parseInt(document.getElementById('roundInput').value);
  const statusEl = document.getElementById('roundStatus');
  const resultEl = document.getElementById('roundResult');
  
  if (!roundNum || roundNum < 1) {
    statusEl.innerHTML = '<div class="status error">âŒ ì˜¬ë°”ë¥¸ íšŒì°¨ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>';
    return;
  }
  
  statusEl.innerHTML = `<div class="status loading">â³ ${roundNum}íšŒì°¨ ì¡°íšŒ ì¤‘...</div>`;
  resultEl.innerHTML = '';

  try {
    const resp = await fetch(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${roundNum}`, {
      mode: 'cors'
    });
    
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    
    const data = await resp.json();
    
    if (data.returnValue !== 'success') {
      throw new Error('í•´ë‹¹ íšŒì°¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
    
    statusEl.innerHTML = '<div class="status success">âœ… ì¡°íšŒ ì„±ê³µ!</div>';
    
    const numbers = [data.drwtNo1, data.drwtNo2, data.drwtNo3, data.drwtNo4, data.drwtNo5, data.drwtNo6];
    const bonus = data.bnusNo;
    
    resultEl.innerHTML = `
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">íšŒì°¨</div>
          <div class="info-value">${data.drwNo}íšŒ</div>
        </div>
        <div class="info-item">
          <div class="info-label">ì¶”ì²¨ì¼</div>
          <div class="info-value">${data.drwNoDate}</div>
        </div>
      </div>
      <div class="balls-container">
        ${numbers.map(n => createBall(n, false)).join('')}
        <div style="margin: 0 5px; font-size: 20px; color: #999;">+</div>
        ${createBall(bonus, true)}
      </div>
      <div class="result-box">
${JSON.stringify(data, null, 2)}
      </div>
    `;
    
  } catch(error) {
    statusEl.innerHTML = '<div class="status error">âŒ ì˜¤ë¥˜ ë°œìƒ</div>';
    resultEl.innerHTML = `<div class="result-box error">${error.message}</div>`;
  }
}

// â•â• 3. ì—°ì† ì¡°íšŒ í…ŒìŠ¤íŠ¸ â•â•
async function fetchBatch() {
  const start = parseInt(document.getElementById('batchStart').value);
  const end = parseInt(document.getElementById('batchEnd').value);
  const statusEl = document.getElementById('batchStatus');
  const resultEl = document.getElementById('batchResult');
  
  if (!start || !end || start > end) {
    statusEl.innerHTML = '<div class="status error">âŒ ì˜¬ë°”ë¥¸ ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>';
    return;
  }
  
  const total = end - start + 1;
  statusEl.innerHTML = `<div class="status loading">â³ ${total}ê°œ íšŒì°¨ ì¡°íšŒ ì¤‘... (0/${total})</div>`;
  resultEl.innerHTML = '';
  
  const results = [];
  const errors = [];
  
  for (let round = start; round <= end; round++) {
    try {
      const resp = await fetch(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${round}`, {
        mode: 'cors'
      });
      
      if (!resp.ok) throw new Error('HTTP ' + resp.status);
      
      const data = await resp.json();
      
      if (data.returnValue === 'success') {
        results.push({
          round: data.drwNo,
          date: data.drwNoDate,
          numbers: [data.drwtNo1, data.drwtNo2, data.drwtNo3, data.drwtNo4, data.drwtNo5, data.drwtNo6],
          bonus: data.bnusNo
        });
      } else {
        errors.push(`${round}íšŒ: ${data.returnValue}`);
      }
      
      const progress = results.length + errors.length;
      statusEl.innerHTML = `<div class="status loading">â³ ${total}ê°œ íšŒì°¨ ì¡°íšŒ ì¤‘... (${progress}/${total})</div>`;
      
      // Rate Limiting ë°©ì§€: 0.5ì´ˆ ëŒ€ê¸°
      await new Promise(resolve => setTimeout(resolve, 500));
      
    } catch(error) {
      errors.push(`${round}íšŒ: ${error.message}`);
    }
  }
  
  if (errors.length === 0) {
    statusEl.innerHTML = `<div class="status success">âœ… ${results.length}ê°œ íšŒì°¨ ì¡°íšŒ ì™„ë£Œ!</div>`;
  } else {
    statusEl.innerHTML = `<div class="status error">âš ï¸ ${results.length}ê°œ ì„±ê³µ, ${errors.length}ê°œ ì‹¤íŒ¨</div>`;
  }
  
  resultEl.innerHTML = `
    <div class="result-box">
ì„±ê³µ: ${results.length}ê°œ
ì‹¤íŒ¨: ${errors.length}ê°œ

${errors.length > 0 ? 'ì‹¤íŒ¨ íšŒì°¨:\n' + errors.join('\n') + '\n\n' : ''}ì¡°íšŒ ê²°ê³¼:
${JSON.stringify(results, null, 2)}
    </div>
  `;
}
</script>
</body>
</html>
