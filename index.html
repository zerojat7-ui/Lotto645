<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¡œë˜ 6/45 ë¶„ì„ & ì¶”ì²œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container { max-width: 500px; margin: 0 auto; }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 { font-size: 24px; color: #667eea; margin-bottom: 5px; }
        .header p { font-size: 13px; color: #666; }

        .tabs { display: flex; gap: 8px; margin-bottom: 15px; }

        .tab {
            flex: 1; padding: 12px; background: rgba(255,255,255,0.3);
            border: none; border-radius: 10px; color: white;
            font-weight: bold; font-size: 13px; cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active { background: white; color: #667eea; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .tab:disabled { opacity: 0.5; cursor: not-allowed; }

        .content {
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); margin-bottom: 15px;
        }

        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 10px;
            font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; margin-bottom: 10px;
        }

        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #00C49F; color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn:active { transform: scale(0.98); }

        .file-input-wrapper { position: relative; overflow: hidden; width: 100%; margin-bottom: 10px; }
        .file-input-wrapper input[type=file] { position: absolute; left: -9999px; }
        .file-input-label {
            display: block; padding: 15px; background: #8884D8; color: white;
            border-radius: 10px; text-align: center; cursor: pointer;
            font-weight: bold; transition: all 0.3s;
        }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px; border-radius: 10px; text-align: center; color: white;
        }
        .stat-label { font-size: 12px; opacity: 0.9; margin-bottom: 5px; }
        .stat-value { font-size: 28px; font-weight: bold; }

        .number-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 15px 0; }
        .number-item {
            aspect-ratio: 1; background: #f8f9fa; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; padding: 5px; border: 2px solid #e0e0e0;
        }
        .number-item.hot { 
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); 
            border-color: #c92a2a;
        }
        .number-item.cold { 
            background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%); 
            border-color: #1971c2;
        }
        .number-value { font-size: 18px; font-weight: bold; color: #667eea; }
        .number-item.hot .number-value, .number-item.cold .number-value { color: white; }
        .number-count { font-size: 10px; color: #666; margin-top: 2px; }
        .number-item.hot .number-count, .number-item.cold .number-count { color: rgba(255,255,255,0.9); }

        .analysis-section { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .analysis-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .analysis-item { 
            display: flex; justify-content: space-between; 
            padding: 8px 0; border-bottom: 1px solid #dee2e6; 
        }
        .analysis-item:last-child { border-bottom: none; }
        .analysis-label { font-size: 14px; color: #666; }
        .analysis-value { font-size: 14px; font-weight: bold; color: #667eea; }

        .bar-chart { margin: 15px 0; }
        .bar-item { 
            display: flex; align-items: center; margin-bottom: 8px; 
            font-size: 12px;
        }
        .bar-label { 
            width: 30px; text-align: right; margin-right: 8px; 
            font-weight: bold; color: #667eea;
        }
        .bar-fill-container { 
            flex: 1; height: 20px; background: #e9ecef; 
            border-radius: 4px; overflow: hidden; position: relative;
        }
        .bar-fill { 
            height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); 
            transition: width 0.3s;
        }
        .bar-count { 
            position: absolute; right: 5px; top: 50%; 
            transform: translateY(-50%); 
            color: white; font-weight: bold; font-size: 11px;
        }

        .recommendation {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #667eea; border-radius: 12px; padding: 15px; margin-bottom: 15px;
        }
        .rec-header { 
            display: flex; justify-content: space-between; 
            align-items: center; margin-bottom: 12px; 
        }
        .rec-title { font-size: 16px; font-weight: bold; color: #667eea; }
        .rec-numbers { 
            display: flex; gap: 8px; margin-bottom: 10px; 
            flex-wrap: wrap; justify-content: center; 
        }
        .lotto-ball {
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 18px; font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        }
        .lotto-ball.odd { background: linear-gradient(135deg, #FF8042 0%, #FF6B35 100%); }
        .lotto-ball.even { background: linear-gradient(135deg, #00C49F 0%, #00A884 100%); }
        .rec-info {
            display: flex; justify-content: space-around; font-size: 13px; color: #666;
            margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;
        }

        .alert {
            padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 13px;
        }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }

        .section-title {
            font-size: 16px; font-weight: bold; color: #333;
            margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #667eea;
        }


        /* â”€â”€ ë°˜ìë™ íƒ­ ìŠ¤íƒ€ì¼ â”€â”€ */
        .lotto-ticket {
            background: #fff;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 10px 8px;
            margin-bottom: 14px;
            position: relative;
        }
        .ticket-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .ticket-label {
            background: #c00;
            color: white;
            font-weight: bold;
            font-size: 14px;
            width: 28px; height: 28px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .ticket-price {
            font-size: 13px;
            font-weight: bold;
            color: #333;
        }
        .ticket-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .ticket-num {
            aspect-ratio: 1;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #ccc;
            background: #f9f9f9;
            color: #333;
            transition: all 0.15s;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .ticket-num:active { transform: scale(0.9); }
        .ticket-num.selected-manual {
            background: #c00;
            color: white;
            border-color: #c00;
        }
        .ticket-num.selected-auto {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .ticket-num.disabled-num {
            opacity: 0.25;
            cursor: not-allowed;
        }
        .ticket-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 8px;
        }
        .auto-badge {
            font-size: 11px;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .manual-badge {
            font-size: 11px;
            background: #c00;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .ticket-result {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .result-ball {
            width: 34px; height: 34px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.25);
        }
        .ball-manual { background: linear-gradient(135deg, #c00, #ff4444); }
        .ball-auto   { background: linear-gradient(135deg, #667eea, #764ba2); }
        .hidden { display: none !important; }
    </style>
</head>

<!-- Html ë³¸ë¬¸ --->

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ° ë¡œë˜ 6/45 ë¶„ì„</h1>
            <p>ê³ ê¸‰ íŒ¨í„´ ë¶„ì„ & AI ì¶”ì²œ</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('import')">ğŸ“¥ ë°ì´í„°</button>
            <button class="tab" id="tab-analysis" onclick="switchTab('analysis')" disabled>ğŸ“Š ë¶„ì„</button>
            <button class="tab" id="tab-recommend" onclick="switchTab('recommend')" disabled>ğŸ¯ ì¶”ì²œ</button>
            <button class="tab" id="tab-semiauto" onclick="switchTab('semiauto')" disabled>âœï¸ ë°˜ìë™</button>
        </div>

        <!-- ë°ì´í„° ê°€ì ¸ì˜¤ê¸° íƒ­ -->
<div id="content-import" class="content">
    <div class="section-title">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</div>
    

    <!-- ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìƒíƒœ -->
    <div style="background:#f0f4ff; border:1px solid #c5d0f5; border-radius:10px; padding:12px; margin-bottom:10px;">
        <div style="font-size:13px; font-weight:bold; color:#667eea; margin-bottom:8px;">ğŸ’¾ ë¸Œë¼ìš°ì € ìë™ì €ì¥</div>
        <div id="lsStatus" style="font-size:12px; color:#888; margin-bottom:8px;">í™•ì¸ ì¤‘...</div>
        <div style="display:flex; gap:8px;">
            <button onclick="loadFromLocalStorage()" style="flex:1; padding:8px; background:#667eea; color:white; border:none; border-radius:8px; font-size:13px; font-weight:bold; cursor:pointer;">
                ğŸ“‚ ì €ì¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
            <button onclick="clearLocalStorage()" style="padding:8px 12px; background:#ff6b6b; color:white; border:none; border-radius:8px; font-size:13px; cursor:pointer;">
                ğŸ—‘ï¸
            </button>
        </div>
    </div>

    <div class="file-input-wrapper">
        <input type="file" id="csvFile" accept=".csv" onchange="handleFileUpload(event)">
        <label for="csvFile" class="file-input-label" id="fileLabel">ğŸ“„ CSV íŒŒì¼ ì„ íƒ</label>
    </div>

    <!-- ğŸ‰ ì°¨íšŒ ë‹¹ì²¨ë²ˆí˜¸ ì…ë ¥ ì˜ì—­ -->
    <div class="analysis-section">
        <div class="analysis-title">ğŸ‰ ì°¨íšŒ ë‹¹ì²¨ë²ˆí˜¸ ì…ë ¥</div>
        <input type="number" id="newRound" placeholder="íšŒì°¨" style="width:100%;padding:10px;margin-bottom:8px;border-radius:8px;border:1px solid #ccc;">
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:8px;">
            <input type="number" class="newNum" placeholder="ë²ˆí˜¸1">
            <input type="number" class="newNum" placeholder="ë²ˆí˜¸2">
            <input type="number" class="newNum" placeholder="ë²ˆí˜¸3">
            <input type="number" class="newNum" placeholder="ë²ˆí˜¸4">
            <input type="number" class="newNum" placeholder="ë²ˆí˜¸5">
            <input type="number" class="newNum" placeholder="ë²ˆí˜¸6">
        </div>
        <button class="btn btn-primary" onclick="addNewDraw()">ì…ë ¥ ì €ì¥</button>
    </div>

    <button class="btn btn-secondary" onclick="exportCSV()">ğŸ’¾ CSVë¡œ ë°ì´í„° ì €ì¥</button>

    <div id="importSuccess" class="alert alert-success hidden"></div>
    <div id="statusBoard" class="alert alert-info hidden">
        <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“Š ë¡œë”© ìƒíƒœ</div>
        <div id="statusLog" style="font-size: 12px; font-family: monospace; line-height: 1.6; max-height: 200px; overflow-y: auto;"></div>
    </div>
</div>

        <!-- ë¶„ì„ íƒ­ -->
        <div id="content-analysis" class="content hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì´ íšŒì°¨</div>
                    <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ë¶„ì„ ë²”ìœ„</div>
                    <div class="stat-value" id="stat-range">ìµœê·¼20</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í™€ìˆ˜ ë¹„ìœ¨</div>
                    <div class="stat-value" id="stat-odd">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì§ìˆ˜ ë¹„ìœ¨</div>
                    <div class="stat-value" id="stat-even">0%</div>
                </div>
            </div>


            <div class="section-title">ğŸ“Š ë²ˆí˜¸ë³„ ìƒì„¸ íŒ¨í„´ (1~45)</div>
<div class="number-grid" id="allNumbersGrid"></div>

<div id="numberDetail" class="analysis-section hidden"></div>
            <div class="analysis-section">
                <div class="analysis-title">ğŸ“ˆ ì—°ì†ë²ˆí˜¸ ë¶„ì„</div>
                <div class="analysis-item">
                    <span class="analysis-label">ì „ì²´ ì—°ì†ë²ˆí˜¸ í¬í•¨ìœ¨</span>
                    <span class="analysis-value" id="consec-all">0%</span>
                </div>
                <div class="analysis-item">
                    <span class="analysis-label">ì „ì²´ í‰ê·  ì—°ì†ë²ˆí˜¸ ê°œìˆ˜</span>
                    <span class="analysis-value" id="consec-all-avg">0ê°œ</span>
                </div>
                <div class="analysis-item">
                    <span class="analysis-label">ìµœê·¼ 20íšŒ ì—°ì†ë²ˆí˜¸ í¬í•¨ìœ¨</span>
                    <span class="analysis-value" id="consec-recent">0%</span>
                </div>
                <div class="analysis-item">
                    <span class="analysis-label">ìµœê·¼ 20íšŒ í‰ê·  ì—°ì†ë²ˆí˜¸</span>
                    <span class="analysis-value" id="consec-recent-avg">0ê°œ</span>
                </div>
            </div>

            <div class="analysis-section">
                <div class="analysis-title">ğŸ”— ACê°’ ë¶„ì„ (ì¸ì ‘ ìˆ«ì ìŒ)</div>
                <div class="analysis-item">
                    <span class="analysis-label">ì „ì²´ í‰ê·  ACê°’</span>
                    <span class="analysis-value" id="ac-all">0</span>
                </div>
                <div class="analysis-item">
                    <span class="analysis-label">ìµœê·¼ 20íšŒ í‰ê·  ACê°’</span>
                    <span class="analysis-value" id="ac-recent">0</span>
                </div>
                <div class="analysis-item">
                    <span class="analysis-label">ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ACê°’</span>
                    <span class="analysis-value" id="ac-mode">0</span>
                </div>
            </div>

            <div class="section-title">ğŸ† TOP 15 ë¹ˆì¶œ ë²ˆí˜¸</div>
            <div class="bar-chart" id="topBars"></div>
        </div>

        <!-- ì¶”ì²œ íƒ­ -->
       <div id="content-recommend" class="content hidden">
    <div class="section-title">ğŸ¯ AI ì¶”ì²œ ë²ˆí˜¸ ì¡°í•©</div>

    <div class="analysis-section" style="text-align:center;">
        <div style="font-weight:bold;">
            ì¶”ì²œ ëŒ€ìƒ íšŒì°¨ :
            <span id="nextRoundLabel">-</span> íšŒ
        </div>
        <div style="margin-top:6px;font-size:12px;color:#666;">
            í˜„ì¬ ê°±ì‹  íšŸìˆ˜ : <span id="refreshCount">0</span>
        </div>
    </div>

<hr style="margin:20px 0;">

<button class="btn btn-primary" id="advancedBtn" onclick="runAdvancedEngine()">
    ğŸš€ ê³ ê¸‰ 50íšŒ ë¶„ì„ ì‹¤í–‰
</button>

<!-- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë°•ìŠ¤ -->
<div id="advancedMonitor" style="display:none; background:#1a1a2e; border-radius:12px; padding:15px; margin-bottom:15px; color:white;">
    <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px;">
        <span>ğŸ”„ ë¶„ì„ ì§„í–‰ ì¤‘...</span>
        <span id="monitorPercent" style="font-weight:bold; color:#00ff88;">0%</span>
    </div>
    <div style="background:#333; border-radius:8px; height:18px; overflow:hidden; margin-bottom:12px;">
        <div id="monitorBar" style="height:100%; width:0%; background:linear-gradient(90deg,#667eea,#00ff88); transition:width 0.3s; border-radius:8px;"></div>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:12px; text-align:center;">
        <div style="background:#16213e; border-radius:8px; padding:10px;">
            <div style="font-size:11px; color:#aaa; margin-bottom:4px;">ì§„í–‰ íšŒì°¨</div>
            <div id="monitorRound" style="font-size:22px; font-weight:bold; color:#667eea;">0</div>
            <div style="font-size:10px; color:#666;">/ 50</div>
        </div>
        <div style="background:#16213e; border-radius:8px; padding:10px;">
            <div style="font-size:11px; color:#aaa; margin-bottom:4px;">í›„ë³´ ìˆ˜ì§‘</div>
            <div id="monitorCandidates" style="font-size:22px; font-weight:bold; color:#ffd700;">0</div>
            <div style="font-size:10px; color:#666;">ê°œ</div>
        </div>
        <div style="background:#16213e; border-radius:8px; padding:10px;">
            <div style="font-size:11px; color:#aaa; margin-bottom:4px;">í˜„ì¬ ìµœê³ ì </div>
            <div id="monitorBestScore" style="font-size:22px; font-weight:bold; color:#ff6b6b;">-</div>
            <div style="font-size:10px; color:#666;">ì </div>
        </div>
    </div>
    <div style="background:#16213e; border-radius:8px; padding:10px; margin-bottom:10px;">
        <div style="font-size:11px; color:#aaa; margin-bottom:6px;">ğŸ² í˜„ì¬ ë¶„ì„ ì¤‘ì¸ ì¡°í•©</div>
        <div id="monitorCurrentCombo" style="display:flex; gap:6px; justify-content:center; min-height:36px; align-items:center;">
            <span style="color:#555; font-size:12px;">ëŒ€ê¸° ì¤‘...</span>
        </div>
    </div>
    <div style="background:#0d1117; border-radius:8px; padding:10px;">
        <div style="font-size:11px; color:#aaa; margin-bottom:6px;">ğŸ“‹ ë¶„ì„ ë¡œê·¸</div>
        <div id="monitorLog" style="font-size:11px; font-family:monospace; color:#00ff88; max-height:100px; overflow-y:auto; line-height:1.8;"></div>
    </div>
</div>

<div id="advancedResults"></div>

    <button class="btn btn-primary" onclick="refreshRecommendations()">ğŸ”„ ê°±ì‹ </button>
    <button class="btn btn-secondary" onclick="saveRecommendations()">ğŸ’¾ ì¶”ì²œë²ˆí˜¸ ì €ì¥</button>

    <div class="file-input-wrapper">
        <input type="file" id="recFile" accept=".csv" onchange="loadRecommendations(event)">
        <label for="recFile" class="file-input-label">ğŸ“‚ ì¶”ì²œë²ˆí˜¸ ë¶ˆëŸ¬ì˜¤ê¸°</label>
    </div>

    <div id="recommendations"></div>

    <!-- ì¶”ì²œë²ˆí˜¸ ë¶„ì„ íŒ¨ë„ -->
    <div id="recAnalysisPanel" style="display:none; margin-top:10px;">

        <div style="background:#1a1a2e; border-radius:12px; padding:15px; margin-bottom:12px; color:white;">
            <div style="font-size:14px; font-weight:bold; margin-bottom:8px;">âš™ï¸ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤</div>
            <div id="recProcessLog" style="font-size:12px; font-family:monospace; color:#00ff88; line-height:1.8; max-height:160px; overflow-y:auto;"></div>
        </div>

        <div id="recResult" class="analysis-section" style="display:none;"></div>

        <div style="background:#fff3e0; border:1px solid #ffb74d; border-radius:12px; padding:15px; margin-bottom:12px;">
            <div style="font-size:14px; font-weight:bold; color:#e65100; margin-bottom:10px;">ğŸ” ì¶”ì²œë²ˆí˜¸ ê°„ ì¤‘ë³µ ë¶„ì„</div>
            <div id="recDupResult"></div>
        </div>

        <div style="background:#e8f5e9; border:1px solid #81c784; border-radius:12px; padding:15px; margin-bottom:12px;">
            <div style="font-size:14px; font-weight:bold; color:#2e7d32; margin-bottom:10px;">ğŸ“Š ì¶”ì²œë²ˆí˜¸ ë¶„í¬ë„</div>
            <div id="recDistResult"></div>
        </div>

        <button class="btn btn-primary" onclick="mergeRecToData()">
            ğŸ“¥ ì¶”ì²œë²ˆí˜¸ â†’ ë‹¹ì²¨ë°ì´í„° ì¶”ê°€ í›„ CSV ì €ì¥
        </button>
        <div id="mergeResult" class="alert alert-success" style="display:none; margin-top:8px;"></div>
    </div>

    <div class="alert alert-warning" style="text-align:center; margin-top:10px;">
        âš ï¸ ë¡œë˜ëŠ” í™•ë¥  ê²Œì„ì…ë‹ˆë‹¤.
    </div>
</div>

        <!-- ë°˜ìë™ íƒ­ -->
        <div id="content-semiauto" class="content hidden">
            <div class="section-title">âœï¸ ë°˜ìë™ ë²ˆí˜¸ ìƒì„±</div>
            <div class="alert alert-info" style="margin-bottom:14px; font-size:13px;">
                ë²ˆí˜¸ë¥¼ ì§ì ‘ í„°ì¹˜í•´ì„œ ì„ íƒí•˜ì„¸ìš” (ìµœëŒ€ 5ê°œ).<br>
                ë‚˜ë¨¸ì§€ëŠ” í†µê³„ ê¸°ë°˜ìœ¼ë¡œ ìë™ ì™„ì„±ë©ë‹ˆë‹¤.
            </div>

            <div id="semiautoTickets"></div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:10px;">
                <button class="btn btn-primary" style="margin:0;" onclick="addSemiTicket()">+ ê²Œì„ ì¶”ê°€</button>
                <button class="btn btn-secondary" style="margin:0;" onclick="clearAllTickets()">ì´ˆê¸°í™”</button>
            </div>

            <div id="semiResultPanel" style="display:none;">
                <div class="section-title" style="margin-top:10px;">ğŸŸï¸ ì™„ì„±ëœ ë²ˆí˜¸</div>
                <div id="semiResultList"></div>
                <button class="btn btn-primary" onclick="regenerateAuto()">ğŸ”„ ìë™ë¶€ë¶„ ë‹¤ì‹œ ìƒì„±</button>
            </div>
        </div>

    <script>
        let lottoData = [];
        let analysis = null;
        let currentRecommendations = [];
let refreshCounter = 0;
let recommendationHistory = [];

let advancedPool = [];
let finalTop5 = [];


        function addLog(message, type = 'info') {
            const statusBoard = document.getElementById('statusBoard');
            const statusLog = document.getElementById('statusLog');
            statusBoard.classList.remove('hidden');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            const color = type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460';
            const logEntry = document.createElement('div');
            logEntry.style.color = color;
            logEntry.innerHTML = `[${timestamp}] ${icon} ${message}`;
            statusLog.appendChild(logEntry);
            statusLog.scrollTop = statusLog.scrollHeight;
        }

        function clearLog() {
            document.getElementById('statusLog').innerHTML = '';
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            event.target.classList.add('active');
            ['import','analysis','recommend','semiauto'].forEach(function(id) {
                document.getElementById('content-' + id).classList.add('hidden');
            });
            document.getElementById('content-' + tab).classList.remove('hidden');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            clearLog();
            addLog(`íŒŒì¼: ${file.name} (${(file.size/1024).toFixed(2)} KB)`);
            const fileLabel = document.getElementById('fileLabel');
            fileLabel.innerHTML = 'â³ ì½ëŠ” ì¤‘...';
            fileLabel.style.background = '#FFA500';
            const reader = new FileReader();
            reader.onload = function(e) {
                addLog('íŒŒì¼ ì½ê¸° ì™„ë£Œ');
                parseCSVData(e.target.result, file.name);
            };
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSVData(csvText, fileName) {
            try {
                const lines = csvText.replace(/\r\n/g, '\n').replace(/\r/g, '\n').trim().split('\n');
                addLog(`ì´ ${lines.length}ì¤„ íŒŒì‹± ì‹œì‘`);
                lottoData = [];
                let startIndex = lines[0].match(/[ê°€-í£a-zA-Z]/) ? 1 : 0;
                
                for (let i = startIndex; i < lines.length; i++) {
                    const values = lines[i].trim().split(',').map(v => v.trim());
                    if (values.length >= 7) {
                        const round = parseInt(values[0]);
                        const numbers = values.slice(1, 7).map(v => parseInt(v));
                        if (!isNaN(round) && numbers.every(n => !isNaN(n) && n >= 1 && n <= 45)) {
                            lottoData.push({ round, numbers });
                        }
                    }
                }
                
                if (lottoData.length > 0) {
                    addLog(`âœ… ${lottoData.length}ê°œ íšŒì°¨ ë¡œë“œ ì„±ê³µ!`, 'success');
                    document.getElementById('importSuccess').innerHTML = `âœ… <strong>${lottoData.length}</strong>ê°œ íšŒì°¨ (${lottoData[0].round}~${lottoData[lottoData.length-1].round}íšŒ)`;
                    document.getElementById('importSuccess').classList.remove('hidden');
                    const fileLabel = document.getElementById('fileLabel');
                    fileLabel.innerHTML = 'âœ… ë¡œë“œ ì™„ë£Œ';
                    fileLabel.style.background = '#00C49F';
                    analyzeData();
                    document.getElementById('tab-analysis').disabled = false;
                    document.getElementById('tab-recommend').disabled = false;
                    document.getElementById('tab-semiauto').disabled = false;
                } else {
                    addLog('ë°ì´í„° ì—†ìŒ', 'error');
                }
            } catch (error) {
                addLog(`ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        function loadSampleData() {
            clearLog();
            addLog('ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì¤‘...');
            lottoData = [];
            for (let i = 1; i <= 100; i++) {
                const numbers = [];
                while (numbers.length < 6) {
                    const num = Math.floor(Math.random() * 45) + 1;
                    if (!numbers.includes(num)) numbers.push(num);
                }
                lottoData.push({ round: i, numbers: numbers.sort((a,b) => a-b) });
            }
            addLog('âœ… ìƒ˜í”Œ 100ê°œ ìƒì„± ì™„ë£Œ', 'success');
            document.getElementById('importSuccess').innerHTML = `âœ… <strong>100</strong>ê°œ ìƒ˜í”Œ ë°ì´í„°`;
            document.getElementById('importSuccess').classList.remove('hidden');
            const fileLabel = document.getElementById('fileLabel');
            fileLabel.innerHTML = 'âœ… ë¡œë“œ ì™„ë£Œ';
            fileLabel.style.background = '#00C49F';
            analyzeData();
            document.getElementById('tab-analysis').disabled = false;
            document.getElementById('tab-recommend').disabled = false;
            document.getElementById('tab-semiauto').disabled = false;
        }

        function countConsecutive(numbers) {
            let count = 0;
            for (let i = 0; i < numbers.length - 1; i++) {
                if (numbers[i+1] - numbers[i] === 1) count++;
            }
            return count;
        }

        function calculateAC(numbers) {
            const sorted = [...numbers].sort((a,b) => a-b);
            let ac = 0;
            for (let i = 0; i < sorted.length - 1; i++) {
                for (let j = i + 1; j < sorted.length; j++) {
                    if (sorted[j] - sorted[i] === 1) ac++;
                }
            }
            return ac;
        }

        function analyzeData() {
            addLog('ë¶„ì„ ì‹œì‘...');
            
            const frequency = {};
            for (let i = 1; i <= 45; i++) frequency[i] = 0;
            const existingCombos = new Set();
            let oddCount = 0, evenCount = 0;

            lottoData.forEach(draw => {
                draw.numbers.forEach(num => {
                    frequency[num]++;
                    if (num % 2 === 0) evenCount++; else oddCount++;
                });
                existingCombos.add([...draw.numbers].sort((a,b) => a-b).join(','));
            });

            const recent20 = lottoData.slice(-20);
            const recentFreq = {};
            for (let i = 1; i <= 45; i++) recentFreq[i] = 0;
            recent20.forEach(draw => {
                draw.numbers.forEach(num => recentFreq[num]++);
            });

            const recentSorted = Object.keys(recentFreq).map(n => ({
                number: parseInt(n),
                count: recentFreq[n]
            })).sort((a,b) => b.count - a.count);

            const hotNumbers = recentSorted.slice(0, 10).map(s => s.number);
            const coldNumbers = recentSorted.slice(-10).map(s => s.number);

            let consecCountAll = 0, consecPresentAll = 0;
            let consecCountRecent = 0, consecPresentRecent = 0;
            
            lottoData.forEach(draw => {
                const consec = countConsecutive(draw.numbers);
                if (consec > 0) consecPresentAll++;
                consecCountAll += consec;
            });

            recent20.forEach(draw => {
                const consec = countConsecutive(draw.numbers);
                if (consec > 0) consecPresentRecent++;
                consecCountRecent += consec;
            });

            const acValues = lottoData.map(draw => calculateAC(draw.numbers));
            const acRecent = recent20.map(draw => calculateAC(draw.numbers));
            const acAvgAll = (acValues.reduce((a,b) => a+b, 0) / acValues.length).toFixed(2);
            const acAvgRecent = (acRecent.reduce((a,b) => a+b, 0) / acRecent.length).toFixed(2);
            
            const acMode = acValues.reduce((acc, val) => {
                acc[val] = (acc[val] || 0) + 1;
                return acc;
            }, {});
            const mostCommonAC = Object.keys(acMode).reduce((a, b) => acMode[a] > acMode[b] ? a : b);

            const numberStats = Object.keys(frequency).map(num => ({
                number: parseInt(num),
                count: frequency[num],
                recentCount: recentFreq[num] || 0
            }));

            const sortedByFreq = [...numberStats].sort((a,b) => b.count - a.count);

            analysis = {
                numberStats, sortedByFreq, existingCombos,
                totalDraws: lottoData.length,
                oddPercentage: (oddCount / (lottoData.length * 6) * 100).toFixed(1),
                evenPercentage: (evenCount / (lottoData.length * 6) * 100).toFixed(1),
                hotNumbers, coldNumbers,
                consecPercentAll: (consecPresentAll / lottoData.length * 100).toFixed(1),
                consecAvgAll: (consecCountAll / lottoData.length).toFixed(2),
                consecPercentRecent: (consecPresentRecent / recent20.length * 100).toFixed(1),
                consecAvgRecent: (consecCountRecent / recent20.length).toFixed(2),
                acAvgAll, acAvgRecent,
                mostCommonAC: parseInt(mostCommonAC)
            };

            addLog('ë¶„ì„ ì™„ë£Œ', 'success');
            updateAnalysisUI();
            generateRecommendations();
            saveToLocalStorage();
        }

        function updateAnalysisUI() {
            document.getElementById('stat-total').textContent = analysis.totalDraws;
            document.getElementById('stat-odd').textContent = analysis.oddPercentage + '%';
            document.getElementById('stat-even').textContent = analysis.evenPercentage + '%';

            // ì „ì²´ 1~45 í‘œì‹œ
const grid = document.getElementById('allNumbersGrid');
grid.innerHTML = '';

for (let i = 1; i <= 45; i++) {

    const stat = analysis.numberStats.find(s => s.number === i);
    const div = document.createElement('div');

    let className = "number-item";

    if (analysis.hotNumbers.includes(i)) className += " hot";
    else if (analysis.coldNumbers.includes(i)) className += " cold";

    div.className = className;

    const freq = ((stat.count / analysis.totalDraws) * 100).toFixed(1);
    div.innerHTML = `
        <div class="number-value">${i}</div>
        <div class="number-count">
            ${stat.count}íšŒ<br>
            <span style="font-size:10px;color:${analysis.hotNumbers.includes(i) || analysis.coldNumbers.includes(i) ? 'rgba(255,255,255,0.9)' : '#999'};">
                ${freq}%
            </span>
        </div>
    `;

    div.onclick = () => showNumberDetail(i);

    grid.appendChild(div);
}

            document.getElementById('consec-all').textContent = analysis.consecPercentAll + '%';
            document.getElementById('consec-all-avg').textContent = analysis.consecAvgAll + 'ê°œ';
            document.getElementById('consec-recent').textContent = analysis.consecPercentRecent + '%';
            document.getElementById('consec-recent-avg').textContent = analysis.consecAvgRecent + 'ê°œ';

            document.getElementById('ac-all').textContent = analysis.acAvgAll;
            document.getElementById('ac-recent').textContent = analysis.acAvgRecent;
            document.getElementById('ac-mode').textContent = analysis.mostCommonAC;

            // ë§‰ëŒ€ ì°¨íŠ¸
            const barsDiv = document.getElementById('topBars');
            barsDiv.innerHTML = '';
            const maxCount = analysis.sortedByFreq[0].count;
            analysis.sortedByFreq.slice(0, 15).forEach(stat => {
                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                const percent = (stat.count / maxCount * 100);
                barItem.innerHTML = `
                    <div class="bar-label">${stat.number}</div>
                    <div class="bar-fill-container">
                        <div class="bar-fill" style="width: ${percent}%"></div>
                        <div class="bar-count">${stat.count}íšŒ</div>
                    </div>
                `;
                barsDiv.appendChild(barItem);
            });
        }

        function generateRecommendations() {
            refreshCounter++;
document.getElementById("refreshCount").textContent = refreshCounter;

const nextRound = lottoData[lottoData.length - 1].round + 1;
document.getElementById("nextRoundLabel").textContent = nextRound;
            addLog('ì¶”ì²œ ë²ˆí˜¸ ìƒì„± ì¤‘...');
            const recommendations = [];
            const maxAttempts = 10000;
            let attempts = 0;

            while (recommendations.length < 5 && attempts < maxAttempts) {
                attempts++;
                const combo = new Set();

                const numHot = 2 + Math.floor(Math.random() * 2);
                for (let i = 0; i < numHot && combo.size < 6; i++) {
                    combo.add(analysis.hotNumbers[Math.floor(Math.random() * Math.min(10, analysis.hotNumbers.length))]);
                }

                while (combo.size < 6) {
                    combo.add(1 + Math.floor(Math.random() * 45));
                }

                const sortedCombo = Array.from(combo).sort((a,b) => a-b);
                const comboStr = sortedCombo.join(',');

                if (!analysis.existingCombos.has(comboStr)) {
                    const oddCount = sortedCombo.filter(n => n % 2 === 1).length;
                    const consec = countConsecutive(sortedCombo);
                    const ac = calculateAC(sortedCombo);
                    
                    if (oddCount >= 2 && oddCount <= 4) {
                        recommendations.push({
                            id: recommendations.length + 1,
                            numbers: sortedCombo,
                            oddCount, evenCount: 6 - oddCount,
                            sum: sortedCombo.reduce((a,b) => a+b, 0),
                            consecutive: consec,
                            ac: ac
                        });
                        analysis.existingCombos.add(comboStr);
                    }
                }
            }

            addLog(`âœ… ${recommendations.length}ê°œ ì¡°í•© ìƒì„± ì™„ë£Œ`, 'success');
            displayRecommendations(recommendations);

currentRecommendations = recommendations;

recommendationHistory.push({
    round: nextRound,
    refresh: refreshCounter,
    combos: recommendations
});

        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendations');
            container.innerHTML = '';

            if (recommendations.length === 0) {
                container.innerHTML = '<div class="alert alert-warning">ì¶”ì²œ ë²ˆí˜¸ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë” ë§ì€ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>';
                return;
            }

            recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation';
                div.innerHTML = `
                    <div class="rec-header">
                        <div class="rec-title">ì¶”ì²œ ì¡°í•© #${rec.id}</div>
                        <div style="font-size: 11px; color: #666;">AC: ${rec.ac} | ì—°ì†: ${rec.consecutive}</div>
                    </div>
                    <div class="rec-numbers">
                        ${rec.numbers.map(num => `
                            <div class="lotto-ball ${num % 2 === 0 ? 'even' : 'odd'}">${num}</div>
                        `).join('')}
                    </div>
                    <div class="rec-info">
                        <div>í™€: <strong>${rec.oddCount}</strong></div>
                        <div>ì§: <strong>${rec.evenCount}</strong></div>
                        <div>í•©: <strong>${rec.sum}</strong></div>
                    </div>
                `;
                container.appendChild(div);
            });
        }


//ë‹¤ìŒíšŒì°¨ ë‹¹ì²¨ë²ˆí˜¸ ì…ë ¥ 
function addNewDraw() {

    const round = parseInt(document.getElementById('newRound').value);
    const nums = Array.from(document.querySelectorAll('.newNum'))
        .map(input => parseInt(input.value))
        .filter(n => !isNaN(n));

    if (!round || nums.length !== 6) {
        addLog("ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
        return;
    }

    if (new Set(nums).size !== 6 || nums.some(n => n < 1 || n > 45)) {
        addLog("ë²ˆí˜¸ëŠ” 1~45 ì‚¬ì´ ì¤‘ë³µì—†ì´ ì…ë ¥í•˜ì„¸ìš”.", "error");
        return;
    }

    // ğŸ” ì¤‘ë³µ íšŒì°¨ ê²€ì‚¬
    if (lottoData.some(d => d.round === round)) {
        addLog("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì°¨ì…ë‹ˆë‹¤.", "error");
        return;
    }

    lottoData.push({
        round: round,
        numbers: nums.sort((a,b)=>a-b)
    });

    lottoData.sort((a,b)=>a.round - b.round);

    addLog("ìµœì¢…íšŒê°€ ì •ìƒ ê¸°ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤", "success");

    analyzeData();
}

//ë‹¹ì²¨ë²ˆí˜¸.csv ì €ì¥ 
function exportCSV() {

    if (lottoData.length === 0) {
        alert("ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    let csv = "íšŒì°¨,ë²ˆí˜¸1,ë²ˆí˜¸2,ë²ˆí˜¸3,ë²ˆí˜¸4,ë²ˆí˜¸5,ë²ˆí˜¸6\n";

    lottoData.forEach(draw => {
        csv += draw.round + "," + draw.numbers.join(",") + "\n";
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "ë‹¹ì²¨ë²ˆí˜¸.csv";
    link.click();
}

//ë²ˆí˜¸ë³„ ë¶„ì„
function showNumberDetail(number) {

    const stat = analysis.numberStats.find(s => s.number === number);

    const appearances = lottoData
        .map(draw => draw.numbers.includes(number))
        .filter(v => v).length;

    const lastDraw = [...lottoData].reverse()
        .find(draw => draw.numbers.includes(number));

    const missStreak = [...lottoData].reverse()
        .findIndex(draw => draw.numbers.includes(number));

    const detail = document.getElementById('numberDetail');
    detail.classList.remove('hidden');

    detail.innerHTML = `
        <div class="analysis-title">${number}ë²ˆ ìƒì„¸ ë¶„ì„</div>
        <div class="analysis-item">
            <span class="analysis-label">ì´ ì¶œí˜„ íšŸìˆ˜</span>
            <span class="analysis-value">${appearances}íšŒ</span>
        </div>
        <div class="analysis-item">
            <span class="analysis-label">ìµœê·¼ ì¶œí˜„ íšŒì°¨</span>
            <span class="analysis-value">${lastDraw ? lastDraw.round : 'ì—†ìŒ'}</span>
        </div>
        <div class="analysis-item">
            <span class="analysis-label">í˜„ì¬ ì—°ì† ë¯¸ì¶œí˜„</span>
            <span class="analysis-value">${missStreak}íšŒ</span>
        </div>
        <div class="analysis-item">
            <span class="analysis-label">ì „ì²´ ì¶œí˜„ í™•ë¥ </span>
            <span class="analysis-value">${(appearances / analysis.totalDraws * 100).toFixed(1)}%</span>
        </div>
    `;
}

//ê°±ì‹  í•¨ìˆ˜

function refreshRecommendations() {
    generateRecommendations();
}
//ì¶”ì²œë²ˆí˜¸ì €ì¥
  function saveRecommendations() {

    if (recommendationHistory.length === 0) {
        alert("ì €ì¥í•  ì¶”ì²œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    let csv = "íšŒì°¨,ê°±ì‹ ,ë²ˆí˜¸1,ë²ˆí˜¸2,ë²ˆí˜¸3,ë²ˆí˜¸4,ë²ˆí˜¸5,ë²ˆí˜¸6\n";

    recommendationHistory.forEach(entry => {
        entry.combos.forEach(c => {
            csv += entry.round + "," + entry.refresh + "," +
                c.numbers.join(",") + "\n";
        });
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "ì¶”ì²œë²ˆí˜¸.csv";
    link.click();
} 

let loadedRecData = [];

function recLog(msg, color) {
    const el = document.getElementById('recProcessLog');
    const d = document.createElement('div');
    d.style.color = color || '#00ff88';
    const ts = new Date().toLocaleTimeString('ko-KR');
    d.textContent = '[' + ts + '] ' + msg;
    el.appendChild(d);
    el.scrollTop = el.scrollHeight;
}

function loadRecommendations(event) {
    const file = event.target.files[0];
    if (!file) return;
    document.getElementById('recAnalysisPanel').style.display = 'block';
    document.getElementById('recProcessLog').innerHTML = '';
    document.getElementById('recDupResult').innerHTML = '';
    document.getElementById('recDistResult').innerHTML = '';
    document.getElementById('recResult').style.display = 'none';
    document.getElementById('mergeResult').style.display = 'none';
    loadedRecData = [];
    recLog('íŒŒì¼ ë¡œë“œ: ' + file.name);
    const reader = new FileReader();
    reader.onload = function(e) {
        recLog('íŒŒì¼ ì½ê¸° ì™„ë£Œ');
        const lines = e.target.result.replace(/\r\n/g,'\n').replace(/\r/g,'\n').trim().split('\n');
        recLog('ì´ ' + lines.length + 'ì¤„ íŒŒì‹±');
        let parsed = 0, skipped = 0;
        lines.slice(1).forEach(function(line) {
            const parts = line.split(',').map(function(v) { return v.trim(); });
            if (parts.length < 8) { skipped++; return; }
            const round = parseInt(parts[0]);
            const refresh = parseInt(parts[1]);
            const nums = parts.slice(2, 8).map(function(n) { return parseInt(n); });
            if (isNaN(round) || nums.some(isNaN)) { skipped++; return; }
            loadedRecData.push({ round: round, refresh: refresh, numbers: nums });
            parsed++;
        });
        recLog('ì™„ë£Œ: ' + parsed + 'ê°œ ìœ íš¨, ' + skipped + 'ê°œ ê±´ë„ˆëœ€');
        let total = 0, totalMatch = 0;
        const matchDetail = {0:0,1:0,2:0,3:0,4:0,5:0,6:0};
        loadedRecData.forEach(function(rec) {
            const actual = lottoData.find(function(d) { return d.round === rec.round; });
            if (actual) {
                const match = rec.numbers.filter(function(n) { return actual.numbers.includes(n); }).length;
                totalMatch += match;
                matchDetail[match]++;
                total++;
            }
        });
        if (total > 0) {
            const rate = (totalMatch / (total * 6) * 100).toFixed(2);
            recLog('ì ì¤‘ ë¶„ì„: ' + total + 'ê°œ ë¹„êµ, ' + rate + '%');
            const recResultEl = document.getElementById('recResult');
            recResultEl.style.display = 'block';
            let rows = '';
            for (let k = 6; k >= 0; k--) {
                if (matchDetail[k] > 0) {
                    const label = k===6?'1ë“±':k===5?'2/3ë“±':k===4?'4ë“±':k===3?'5ë“±':(k+'ê°œ ì¼ì¹˜');
                    rows += '<div class="analysis-item"><span class="analysis-label">' + label + '</span><span class="analysis-value">' + matchDetail[k] + 'íšŒ</span></div>';
                }
            }
            recResultEl.innerHTML = '<div class="analysis-title">ì ì¤‘ë¥  ìƒì„¸</div>' +
                '<div class="analysis-item"><span class="analysis-label">ì´ ë¹„êµ</span><span class="analysis-value">' + total + 'ê°œ</span></div>' +
                '<div class="analysis-item"><span class="analysis-label">ì´ ì¼ì¹˜</span><span class="analysis-value">' + totalMatch + 'ê°œ</span></div>' +
                '<div class="analysis-item"><span class="analysis-label">í‰ê·  ì ì¤‘ë¥ </span><span class="analysis-value">' + rate + '%</span></div>' + rows;
        } else {
            recLog('ë§¤ì¹­ íšŒì°¨ ì—†ìŒ');
        }
        recLog('ì¤‘ë³µ ë¶„ì„ ì¤‘...');
        analyzeRecDuplication();
        recLog('ë¶„í¬ë„ ë¶„ì„ ì¤‘...');
        analyzeRecDistribution();
        recLog('ëª¨ë“  ë¶„ì„ ì™„ë£Œ!');
    };
    reader.readAsText(file, 'UTF-8');
}

function analyzeRecDuplication() {
    const el = document.getElementById('recDupResult');
    if (loadedRecData.length === 0) { el.innerHTML = '<div>ë°ì´í„° ì—†ìŒ</div>'; return; }
    const keys = loadedRecData.map(function(r) { return r.numbers.join(','); });
    const dupMap = {};
    keys.forEach(function(k, i) {
        if (!dupMap[k]) dupMap[k] = [];
        dupMap[k].push(i + 2);
    });
    const dups = Object.entries(dupMap).filter(function(e) { return e[1].length > 1; });
    const sample = loadedRecData.slice(0, Math.min(loadedRecData.length, 20));
    let maxOverlap = 0;
    const overlapPairs = [];
    for (let i = 0; i < sample.length; i++) {
        for (let j = i + 1; j < sample.length; j++) {
            const shared = sample[i].numbers.filter(function(n) { return sample[j].numbers.includes(n); });
            if (shared.length >= 3) overlapPairs.push({ i: i+1, j: j+1, shared: shared, count: shared.length });
            if (shared.length > maxOverlap) maxOverlap = shared.length;
        }
    }
    overlapPairs.sort(function(a,b) { return b.count - a.count; });
    let html = '';
    if (dups.length > 0) {
        html += '<div style="background:#ffebee;border-radius:8px;padding:10px;margin-bottom:8px;">';
        html += '<div style="font-weight:bold;color:#c62828;margin-bottom:6px;">ì™„ì „ ë™ì¼ ì¡°í•©: ' + dups.length + 'ê±´</div>';
        dups.forEach(function(d) {
            html += '<div style="font-size:12px;color:#c62828;">[' + d[0] + '] - ' + d[1].length + 'íšŒ ì¤‘ë³µ</div>';
        });
        html += '</div>';
    } else {
        html += '<div style="background:#e8f5e9;border-radius:8px;padding:10px;margin-bottom:8px;font-size:13px;color:#2e7d32;">ì™„ì „ ì¤‘ë³µ ì—†ìŒ</div>';
    }
    if (overlapPairs.length > 0) {
        html += '<div style="font-size:13px;font-weight:bold;color:#e65100;margin-bottom:6px;">3ê°œ ì´ìƒ ë²ˆí˜¸ ê²¹ì¹¨ (' + overlapPairs.length + 'ìŒ)</div>';
        overlapPairs.slice(0, 10).forEach(function(p) {
            html += '<div style="display:flex;align-items:center;gap:6px;margin-bottom:6px;flex-wrap:wrap;">';
            html += '<span style="font-size:12px;color:#666;">ì¡°í•©' + p.i + ' vs ì¡°í•©' + p.j + ' (' + p.count + 'ê°œ):</span>';
            p.shared.forEach(function(n) {
                html += '<div style="width:28px;height:28px;border-radius:50%;background:#ff8042;display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:bold;">' + n + '</div>';
            });
            html += '</div>';
        });
    } else {
        html += '<div style="font-size:13px;color:#2e7d32;">3ê°œ ì´ìƒ ê²¹ì¹¨ ì—†ìŒ</div>';
    }
    html += '<div style="font-size:12px;color:#999;margin-top:8px;">ìµœëŒ€ ê²¹ì¹¨: ' + maxOverlap + 'ê°œ</div>';
    el.innerHTML = html;
}

function analyzeRecDistribution() {
    const el = document.getElementById('recDistResult');
    if (loadedRecData.length === 0) { el.innerHTML = '<div>ë°ì´í„° ì—†ìŒ</div>'; return; }
    const freq = {};
    for (let i = 1; i <= 45; i++) freq[i] = 0;
    loadedRecData.forEach(function(r) { r.numbers.forEach(function(n) { freq[n]++; }); });
    const ranges = {'1-9':0,'10-19':0,'20-29':0,'30-39':0,'40-45':0};
    loadedRecData.forEach(function(r) {
        r.numbers.forEach(function(n) {
            if (n<=9) ranges['1-9']++;
            else if (n<=19) ranges['10-19']++;
            else if (n<=29) ranges['20-29']++;
            else if (n<=39) ranges['30-39']++;
            else ranges['40-45']++;
        });
    });
    let odd = 0, even = 0;
    loadedRecData.forEach(function(r) {
        r.numbers.forEach(function(n) { n%2===1 ? odd++ : even++; });
    });
    const total = odd + even;
    const sorted = Object.entries(freq).filter(function(e) { return e[1]>0; }).sort(function(a,b) { return b[1]-a[1]; });
    const maxFreq = sorted.length > 0 ? sorted[0][1] : 1;
    const rangeColors = {'1-9':'#667eea','10-19':'#f093fb','20-29':'#4facfe','30-39':'#43e97b','40-45':'#fa709a'};
    const rangeTotal = Object.values(ranges).reduce(function(a,b) { return a+b; }, 0);
    let html = '<div style="margin-bottom:12px;">';
    html += '<div style="font-size:12px;color:#555;margin-bottom:6px;font-weight:bold;">í™€ì§ ë¶„í¬</div>';
    html += '<div style="display:flex;gap:8px;">';
    html += '<div style="flex:' + odd + ';background:#FF8042;border-radius:6px;padding:8px;text-align:center;color:white;font-size:13px;font-weight:bold;">í™€ìˆ˜ ' + odd + '<br><span style="font-size:11px;">' + (odd/total*100).toFixed(1) + '%</span></div>';
    html += '<div style="flex:' + even + ';background:#00C49F;border-radius:6px;padding:8px;text-align:center;color:white;font-size:13px;font-weight:bold;">ì§ìˆ˜ ' + even + '<br><span style="font-size:11px;">' + (even/total*100).toFixed(1) + '%</span></div>';
    html += '</div></div>';
    html += '<div style="margin-bottom:12px;">';
    html += '<div style="font-size:12px;color:#555;margin-bottom:6px;font-weight:bold;">êµ¬ê°„ë³„ ë¶„í¬</div>';
    Object.entries(ranges).forEach(function(entry) {
        const label = entry[0], cnt = entry[1];
        const pct = rangeTotal > 0 ? (cnt/rangeTotal*100).toFixed(1) : 0;
        html += '<div style="display:flex;align-items:center;margin-bottom:5px;">';
        html += '<div style="width:50px;font-size:11px;color:#555;">' + label + '</div>';
        html += '<div style="flex:1;background:#eee;border-radius:4px;height:18px;overflow:hidden;position:relative;">';
        html += '<div style="width:' + pct + '%;height:100%;background:' + rangeColors[label] + ';border-radius:4px;"></div>';
        html += '<div style="position:absolute;right:4px;top:50%;transform:translateY(-50%);font-size:11px;font-weight:bold;color:#333;">' + cnt + 'ê°œ (' + pct + '%)</div>';
        html += '</div></div>';
    });
    html += '</div>';
    html += '<div style="font-size:12px;color:#555;margin-bottom:6px;font-weight:bold;">TOP 10 ì¶”ì²œë²ˆí˜¸</div>';
    sorted.slice(0, 10).forEach(function(entry) {
        const num = entry[0], cnt = entry[1];
        const pct = (cnt / maxFreq * 100).toFixed(0);
        const isHot = analysis && analysis.hotNumbers && analysis.hotNumbers.includes(parseInt(num));
        const bg = isHot ? '#ff6b6b' : '#667eea';
        html += '<div style="display:flex;align-items:center;margin-bottom:5px;">';
        html += '<div style="width:28px;text-align:right;font-size:12px;font-weight:bold;color:' + bg + ';margin-right:6px;">' + num + '</div>';
        html += '<div style="flex:1;background:#eee;border-radius:4px;height:18px;overflow:hidden;position:relative;">';
        html += '<div style="width:' + pct + '%;height:100%;background:' + bg + ';border-radius:4px;"></div>';
        html += '<div style="position:absolute;right:4px;top:50%;transform:translateY(-50%);font-size:11px;font-weight:bold;color:#333;">' + cnt + 'íšŒ' + (isHot?' [í•«]':'') + '</div>';
        html += '</div></div>';
    });
    el.innerHTML = html;
    recLog('ë¶„í¬ë„ ì™„ë£Œ (í™€' + odd + '/ì§' + even + ')');
}

function mergeRecToData() {
    if (loadedRecData.length === 0) { alert('ë¶ˆëŸ¬ì˜¨ ì¶”ì²œë²ˆí˜¸ ì—†ìŒ'); return; }
    recLog('CSV ë³‘í•© ì‹œì‘...');
    let csv = '\uFEFFíšŒì°¨,ë²ˆí˜¸1,ë²ˆí˜¸2,ë²ˆí˜¸3,ë²ˆí˜¸4,ë²ˆí˜¸5,ë²ˆí˜¸6\n';
    lottoData.forEach(function(d) {
        csv += d.round + ',' + d.numbers.join(',') + '\n';
    });
    recLog('ë‹¹ì²¨ë°ì´í„° ' + lottoData.length + 'ê°œ ì¶”ê°€');
    csv += '\níšŒì°¨_ì¶”ì²œ,ê°±ì‹ ,ë²ˆí˜¸1,ë²ˆí˜¸2,ë²ˆí˜¸3,ë²ˆí˜¸4,ë²ˆí˜¸5,ë²ˆí˜¸6\n';
    loadedRecData.forEach(function(rec) {
        csv += rec.round + ',' + rec.refresh + ',' + rec.numbers.join(',') + '\n';
    });
    recLog('ì¶”ì²œë²ˆí˜¸ ' + loadedRecData.length + 'ê°œ ì¶”ê°€');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'ë‹¹ì²¨ë²ˆí˜¸_ì¶”ì²œí¬í•¨.csv';
    link.click();
    const el = document.getElementById('mergeResult');
    el.style.display = 'block';
    el.innerHTML = 'ì €ì¥ ì™„ë£Œ! ë‹¹ì²¨ ' + lottoData.length + 'ê°œ + ì¶”ì²œ ' + loadedRecData.length + 'ê°œ';
    recLog('CSV ì €ì¥ ì™„ë£Œ!');
}


//ì ìˆ˜ê³„ì‚° í•¨ìˆ˜
  function calculateComboScore(combo) {

    let score = 0;

    combo.forEach(num => {

        const stat = analysis.numberStats.find(s => s.number === num);

        // â‘  ì „ì²´ ì¶œí˜„ í™•ë¥  ì ìˆ˜
        score += stat.count * 1.2;

        // â‘¡ ìµœê·¼ 20íšŒ ì¶œí˜„ ì ìˆ˜
        score += stat.recentCount * 2;

        // â‘¢ ì¬ë“±ì¥ í™•ë¥  (ì—°ì†íšŒì°¨ ì¶œí˜„ ê¸°ë°˜)
        const reappear = lottoData.filter((d, i) => {
            if (i === 0) return false;
            return d.numbers.includes(num) && lottoData[i-1].numbers.includes(num);
        }).length;

        score += reappear * 3;

        // â‘£ ìµœê·¼ ë¯¸ì¶œí˜„ ê¸¸ì´ ë³´ì •
        const missStreak = [...lottoData].reverse()
            .findIndex(d => d.numbers.includes(num));

        score += (missStreak < 5 ? 5 : 0);
    });

    // â‘¤ ì—°ì†ë²ˆí˜¸ íŒ¨ë„í‹°/ë³´ë„ˆìŠ¤
    const consec = countConsecutive(combo);
    score += (consec === 1 ? 8 : 0);

    // â‘¥ ACê°’ ë³´ì •
    const ac = calculateAC(combo);
    if (Math.abs(ac - analysis.mostCommonAC) <= 1) score += 10;

    return score;
}

 //20000íšŒ ìƒì„± í•¨ìˆ˜
   function generate20000Combos() {

    const candidates = [];
    const limit = 5000;   // ğŸ”¥ 20000 â†’ 5000ìœ¼ë¡œ ìµœì í™”

    for (let i = 0; i < limit; i++) {

        const set = new Set();

        while (set.size < 6) {
            set.add(1 + Math.floor(Math.random() * 45));
        }

        const combo = Array.from(set).sort((a,b)=>a-b);
        const key = combo.join(",");

        if (!analysis.existingCombos.has(key)) {

            const score = calculateComboScore(combo);

            candidates.push({
                numbers: combo,
                score: score
            });
        }
    }

    candidates.sort((a,b)=>b.score - a.score);

    return candidates.slice(0, 5);
}

//ëª¨ë‹ˆí„°ë§ ë¡œê·¸ ì¶œë ¥
function monitorLog(msg) {
    const el = document.getElementById('monitorLog');
    const line = document.createElement('div');
    line.textContent = '[' + new Date().toLocaleTimeString('ko-KR') + '] ' + msg;
    el.appendChild(line);
    el.scrollTop = el.scrollHeight;
}

//í˜„ì¬ ì¡°í•© í‘œì‹œ
function monitorShowCombo(numbers) {
    const el = document.getElementById('monitorCurrentCombo');
    el.innerHTML = numbers.map(n =>
        `<div style="width:32px;height:32px;border-radius:50%;
        background:${n%2===0?'#00C49F':'#FF8042'};
        display:flex;align-items:center;justify-content:center;
        color:white;font-weight:bold;font-size:13px;">${n}</div>`
    ).join('');
}

//50íšŒ ë¹„ë™ê¸° ë°˜ë³µ ì—”ì§„ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§)
async function runAdvancedEngine() {

    const btn = document.getElementById('advancedBtn');
    btn.disabled = true;
    btn.innerHTML = 'â³ ë¶„ì„ ì¤‘...';

    advancedPool = [];

    // ëª¨ë‹ˆí„° ì´ˆê¸°í™”
    const monitor = document.getElementById('advancedMonitor');
    monitor.style.display = 'block';
    document.getElementById('monitorLog').innerHTML = '';
    document.getElementById('monitorRound').textContent = '0';
    document.getElementById('monitorCandidates').textContent = '0';
    document.getElementById('monitorBestScore').textContent = '-';
    document.getElementById('monitorBar').style.width = '0%';
    document.getElementById('monitorPercent').textContent = '0%';
    document.getElementById('advancedResults').innerHTML = '';
    document.getElementById('monitorCurrentCombo').innerHTML = '<span style="color:#555;font-size:12px;">ë¶„ì„ ì‹œì‘...</span>';

    monitorLog('ğŸš€ ê³ ê¸‰ ë¶„ì„ ì‹œì‘ (50íšŒ Ã— 5000ê°œ)');

    const TOTAL = 50;

    for (let round = 0; round < TOTAL; round++) {

        // ë§¤ íšŒì°¨ë§ˆë‹¤ UIì— ì–‘ë³´ (í™”ë©´ ì—…ë°ì´íŠ¸ í—ˆìš©)
        await new Promise(resolve => setTimeout(resolve, 0));

        const percent = Math.round((round / TOTAL) * 100);
        document.getElementById('monitorBar').style.width = percent + '%';
        document.getElementById('monitorPercent').textContent = percent + '%';
        document.getElementById('monitorRound').textContent = round + 1;

        // 5000ê°œ í›„ë³´ ìƒì„±
        const candidates = [];
        const limit = 5000;

        for (let i = 0; i < limit; i++) {
            const set = new Set();
            while (set.size < 6) set.add(1 + Math.floor(Math.random() * 45));
            const combo = Array.from(set).sort((a,b)=>a-b);
            const key = combo.join(',');

            if (!analysis.existingCombos.has(key)) {
                const score = calculateComboScore(combo);
                candidates.push({ numbers: combo, score });

                // ë§¤ 500ê°œë§ˆë‹¤ í˜„ì¬ ë¶„ì„ ì¤‘ì¸ ì¡°í•© í‘œì‹œ
                if (i % 500 === 0) monitorShowCombo(combo);
            }
        }

        candidates.sort((a,b) => b.score - a.score);
        const top5 = candidates.slice(0, 5);
        top5.forEach(c => advancedPool.push(c));

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('monitorCandidates').textContent = advancedPool.length;

        const bestScore = advancedPool.length > 0
            ? Math.max(...advancedPool.map(c => c.score)).toFixed(1)
            : '-';
        document.getElementById('monitorBestScore').textContent = bestScore;

        if ((round + 1) % 10 === 0) {
            monitorLog(`âœ… ${round + 1}íšŒ ì™„ë£Œ | ëˆ„ì  í›„ë³´: ${advancedPool.length}ê°œ | ìµœê³ ì : ${bestScore}`);
        }
    }

    // ìµœì¢… ì •ë ¬ ë° TOP 5 ì¶”ì¶œ
    advancedPool.sort((a,b) => b.score - a.score);
    finalTop5 = advancedPool.slice(0, 5);

    // ì™„ë£Œ ì²˜ë¦¬
    document.getElementById('monitorBar').style.width = '100%';
    document.getElementById('monitorPercent').textContent = '100%';
    document.getElementById('monitorRound').textContent = '50';
    document.getElementById('monitorCurrentCombo').innerHTML = '<span style="color:#00ff88;font-size:13px;">âœ… ë¶„ì„ ì™„ë£Œ!</span>';
    monitorLog('ğŸ† ìµœì¢… TOP 5 ì„ ì • ì™„ë£Œ! ì•„ë˜ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');

    btn.disabled = false;
    btn.innerHTML = 'ğŸ” ë‹¤ì‹œ ë¶„ì„';

    displayFinalTop5();
}

//ìµœì¢… í‘œì‹œ í•¨ìˆ˜
  function displayFinalTop5() {

    const container = document.getElementById("advancedResults");
    container.innerHTML = "";

    finalTop5.forEach((rec, index) => {

        const div = document.createElement("div");
        div.className = "recommendation";

        div.innerHTML = `
            <div class="rec-header">
                <div class="rec-title">
                    ${index === 0 ? "ğŸ‘‘ ëŒ€í‘œë²ˆí˜¸ (ê³ ê¸‰)" : "ê³ ê¸‰ ì¶”ì²œ"} #${index+1}
                </div>
                <div style="font-size:11px;color:#666;">
                    SCORE: ${rec.score.toFixed(1)}
                </div>
            </div>
            <div class="rec-numbers">
                ${rec.numbers.map(n=>`
                    <div class="lotto-ball ${n%2===0?'even':'odd'}">${n}</div>
                `).join("")}
            </div>
        `;

        container.appendChild(div);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë°˜ìë™ íƒ­ ë¡œì§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var semiTickets = [];   // [{manualNums:[...], autoNums:[...]}]

// ê²Œì„ ì¶”ê°€
function addSemiTicket() {
    if (semiTickets.length >= 5) {
        alert('ìµœëŒ€ 5ê²Œì„ê¹Œì§€ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    semiTickets.push({ manualNums: [], autoNums: [] });
    renderSemiTickets();
}

// ì „ì²´ ì´ˆê¸°í™”
function clearAllTickets() {
    semiTickets = [];
    document.getElementById('semiResultPanel').style.display = 'none';
    renderSemiTickets();
}

// ë²ˆí˜¸ í† ê¸€ (ìˆ˜ë™ ì„ íƒ/í•´ì œ)
function toggleSemiNum(ticketIdx, num) {
    var ticket = semiTickets[ticketIdx];
    var pos = ticket.manualNums.indexOf(num);
    if (pos >= 0) {
        // ì´ë¯¸ ì„ íƒ â†’ í•´ì œ
        ticket.manualNums.splice(pos, 1);
    } else {
        if (ticket.manualNums.length >= 5) {
            alert('ìˆ˜ë™ ë²ˆí˜¸ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            return;
        }
        ticket.manualNums.push(num);
    }
    ticket.autoNums = [];  // ìë™ ë¶€ë¶„ ì´ˆê¸°í™”
    renderSemiTickets();
}

// ìë™ ì™„ì„± (ë‚˜ë¨¸ì§€ ë²ˆí˜¸ ì±„ìš°ê¸°)
function autoFillTicket(ticketIdx) {
    var ticket = semiTickets[ticketIdx];
    var needed = 6 - ticket.manualNums.length;
    if (needed <= 0) return;

    var pool = [];

    if (analysis) {
        // í†µê³„ ê¸°ë°˜ í’€ êµ¬ì„±
        // í•«ë„˜ë²„ ê°€ì¤‘ì¹˜ 2, ë‚˜ë¨¸ì§€ 1
        for (var i = 1; i <= 45; i++) {
            if (ticket.manualNums.indexOf(i) < 0) {
                pool.push(i);
                if (analysis.hotNumbers && analysis.hotNumbers.indexOf(i) >= 0) {
                    pool.push(i); // í•«ë„˜ë²„ëŠ” 2ë°° í™•ë¥ 
                }
            }
        }
    } else {
        for (var i = 1; i <= 45; i++) {
            if (ticket.manualNums.indexOf(i) < 0) pool.push(i);
        }
    }

    // ì…”í”Œ
    for (var i = pool.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var tmp = pool[i]; pool[i] = pool[j]; pool[j] = tmp;
    }

    var picked = [];
    var seen = {};
    for (var i = 0; i < pool.length && picked.length < needed; i++) {
        if (!seen[pool[i]]) {
            seen[pool[i]] = true;
            picked.push(pool[i]);
        }
    }

    ticket.autoNums = picked;
    renderSemiTickets();
    updateSemiResult();
    document.getElementById('semiResultPanel').style.display = 'block';
}

// ìë™ ë¶€ë¶„ë§Œ ì¬ìƒì„±
function regenerateAuto() {
    semiTickets.forEach(function(ticket, idx) {
        if (ticket.manualNums.length > 0 || ticket.autoNums.length > 0) {
            ticket.autoNums = [];
            autoFillTicket(idx);
        }
    });
}

// í‹°ì¼“ ë Œë”ë§
function renderSemiTickets() {
    var container = document.getElementById('semiautoTickets');
    container.innerHTML = '';

    if (semiTickets.length === 0) {
        container.innerHTML = '<div style="text-align:center;color:#aaa;padding:20px;font-size:14px;">+ ê²Œì„ ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</div>';
        return;
    }

    var labels = ['A','B','C','D','E'];

    semiTickets.forEach(function(ticket, ticketIdx) {
        var div = document.createElement('div');
        div.className = 'lotto-ticket';

        // í—¤ë”
        var selectedCount = ticket.manualNums.length;
        var headerHtml = '<div class="ticket-header">' +
            '<div class="ticket-label">' + labels[ticketIdx] + '</div>' +
            '<div style="font-size:12px;color:#666;">' +
                '<span class="manual-badge">ìˆ˜ë™ ' + selectedCount + '</span> ' +
                '<span class="auto-badge">ìë™ ' + (6 - selectedCount) + '</span>' +
            '</div>' +
            '<button onclick="removeSemiTicket(' + ticketIdx + ')" style="background:none;border:none;color:#999;font-size:18px;cursor:pointer;padding:0 4px;">âœ•</button>' +
        '</div>';

        // ë²ˆí˜¸ ê·¸ë¦¬ë“œ (1~45)
        var gridHtml = '<div class="ticket-grid">';
        for (var n = 1; n <= 45; n++) {
            var isManual = ticket.manualNums.indexOf(n) >= 0;
            var isAuto   = ticket.autoNums.indexOf(n) >= 0;
            var cls = 'ticket-num';
            if (isManual) cls += ' selected-manual';
            else if (isAuto) cls += ' selected-auto';

            gridHtml += '<div class="' + cls + '" onclick="toggleSemiNum(' + ticketIdx + ',' + n + ')">' + n + '</div>';
        }
        gridHtml += '</div>';

        // í•˜ë‹¨: ìë™ ì™„ì„± ë²„íŠ¼
        var footerHtml = '<div class="ticket-footer" style="margin-top:10px;">' +
            '<div style="font-size:11px;color:#999;">' +
                (selectedCount === 0 ? 'ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë°”ë¡œ ìë™ ì™„ì„±' :
                 selectedCount === 6 ? '6ê°œ ì„ íƒ ì™„ë£Œ!' :
                 (6 - selectedCount) + 'ê°œ ìë™ ì™„ì„± ëŒ€ê¸°') +
            '</div>' +
            '<button onclick="autoFillTicket(' + ticketIdx + ')" ' +
                'style="padding:6px 14px;background:#667eea;color:white;border:none;border-radius:8px;font-size:13px;font-weight:bold;cursor:pointer;">' +
                (selectedCount === 6 ? 'í™•ì •' : 'ìë™ ì™„ì„±') +
            '</button>' +
        '</div>';

        div.innerHTML = headerHtml + gridHtml + footerHtml;
        container.appendChild(div);
    });
}

// í‹°ì¼“ ì‚­ì œ
function removeSemiTicket(idx) {
    semiTickets.splice(idx, 1);
    renderSemiTickets();
    updateSemiResult();
    if (semiTickets.length === 0) {
        document.getElementById('semiResultPanel').style.display = 'none';
    }
}

// ê²°ê³¼ íŒ¨ë„ ì—…ë°ì´íŠ¸
function updateSemiResult() {
    var list = document.getElementById('semiResultList');
    var labels = ['A','B','C','D','E'];
    var html = '';

    semiTickets.forEach(function(ticket, i) {
        var allNums = ticket.manualNums.concat(ticket.autoNums).sort(function(a,b){return a-b;});
        if (allNums.length === 0) return;

        html += '<div style="background:#f8f9fa;border-radius:10px;padding:12px;margin-bottom:10px;">';
        html += '<div style="font-size:13px;font-weight:bold;color:#667eea;margin-bottom:8px;">' + labels[i] + 'ê²Œì„</div>';
        html += '<div class="ticket-result">';

        allNums.forEach(function(n) {
            var isManual = ticket.manualNums.indexOf(n) >= 0;
            html += '<div class="result-ball ' + (isManual ? 'ball-manual' : 'ball-auto') + '">' + n + '</div>';
        });

        if (allNums.length < 6) {
            for (var k = allNums.length; k < 6; k++) {
                html += '<div class="result-ball" style="background:#ddd;color:#999;">?</div>';
            }
        }

        html += '</div>';
        // ì™„ì„± ì—¬ë¶€ í‘œì‹œ
        if (allNums.length === 6) {
            var sum = allNums.reduce(function(a,b){return a+b;}, 0);
            var oddCnt = allNums.filter(function(n){return n%2===1;}).length;
            html += '<div style="font-size:11px;color:#999;margin-top:6px;">' +
                'í•©ê³„: ' + sum + ' | í™€:' + oddCnt + ' ì§:' + (6-oddCnt) +
                ' | <span style="color:#c00;">ë¹¨ê°•=ìˆ˜ë™</span> <span style="color:#667eea;">íŒŒë‘=ìë™</span>' +
            '</div>';
        }
        html += '</div>';
    });

    if (html === '') {
        html = '<div style="color:#aaa;text-align:center;padding:10px;">ìë™ì™„ì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>';
    }

    list.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìë™ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var LS_KEY = 'lotto645_data';

// ë°ì´í„° ì €ì¥
function saveToLocalStorage() {
    if (lottoData.length === 0) return;
    try {
        var payload = {
            savedAt: new Date().toISOString(),
            count: lottoData.length,
            data: lottoData
        };
        localStorage.setItem(LS_KEY, JSON.stringify(payload));
        showLSStatus('ğŸ’¾ ìë™ì €ì¥ ì™„ë£Œ (' + lottoData.length + 'íšŒì°¨)', '#00C49F');
    } catch(e) {
        showLSStatus('âš ï¸ ì €ì¥ ì‹¤íŒ¨: ' + e.message, '#ff6b6b');
    }
}

// ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
function loadFromLocalStorage() {
    try {
        var raw = localStorage.getItem(LS_KEY);
        if (!raw) return false;
        var payload = JSON.parse(raw);
        if (!payload.data || payload.data.length === 0) return false;
        lottoData = payload.data;
        var savedAt = new Date(payload.savedAt).toLocaleString('ko-KR');
        showLSStatus('ğŸ“‚ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜´ (' + payload.count + 'íšŒì°¨ Â· ' + savedAt + ')', '#667eea');
        document.getElementById('importSuccess').innerHTML =
            'âœ… <strong>' + lottoData.length + '</strong>ê°œ íšŒì°¨ ë¡œë“œ (ë¡œì»¬ ì €ì¥ì†Œ)';
        document.getElementById('importSuccess').classList.remove('hidden');
        var fileLabel = document.getElementById('fileLabel');
        fileLabel.innerHTML = 'âœ… ì €ì¥ëœ ë°ì´í„° ìˆìŒ';
        fileLabel.style.background = '#00C49F';
        analyzeData();
        document.getElementById('tab-analysis').disabled = false;
        document.getElementById('tab-recommend').disabled = false;
        document.getElementById('tab-semiauto').disabled = false;
        return true;
    } catch(e) {
        return false;
    }
}

// ì €ì¥ëœ ë°ì´í„° ì‚­ì œ
function clearLocalStorage() {
    if (!confirm('ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
    localStorage.removeItem(LS_KEY);
    showLSStatus('ğŸ—‘ï¸ ì €ì¥ ë°ì´í„° ì‚­ì œë¨', '#ff6b6b');
}

// ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
function showLSStatus(msg, color) {
    var el = document.getElementById('lsStatus');
    if (!el) return;
    el.textContent = msg;
    el.style.color = color || '#333';
    el.style.display = 'block';
    setTimeout(function() { el.style.display = 'none'; }, 4000);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
window.addEventListener('load', function() {
    var loaded = loadFromLocalStorage();
    if (!loaded) {
        showLSStatus('ğŸ’¡ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. CSVë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', '#888');
    }
});

    </script>
</body>
</html>