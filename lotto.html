<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>최신 로또 결과 저장기</title>
<style>
body { font-family: Arial, sans-serif; padding: 30px; }
button { padding: 10px 15px; margin-right: 10px; }
table { border-collapse: collapse; margin-top: 20px; }
td, th { border: 1px solid #ccc; padding: 8px 12px; }
</style>
</head>
<body>

<h2>최신 로또 결과</h2>

<button onclick="loadLatest()">최신 회차 가져오기</button>
<button onclick="saveCSV()">CSV 저장</button>

<table id="resultTable" style="display:none;">
<thead>
<tr>
<th>회차</th>
<th>추첨일</th>
<th>번호1</th>
<th>번호2</th>
<th>번호3</th>
<th>번호4</th>
<th>번호5</th>
<th>번호6</th>
<th>보너스</th>
<th>당첨자수</th>
<th>금액</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
let latestData = null;

// 최신 회차 자동 찾기
async function getLatestDrawNo() {
    let no = 1200; // 충분히 큰 숫자부터 시작
    while (true) {
        const res = await fetch(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${no}`);
        const data = await res.json();
        if (data.returnValue === "fail") return no - 1;
        no++;
    }
}

// 최신 회차 가져오기
async function loadLatest() {
    const drawNo = await getLatestDrawNo();
    const res = await fetch(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${drawNo}`);
    const d = await res.json();

    latestData = {
        회차: d.drwNo,
        추첨일: d.drwNoDate,
        번호1: d.drwtNo1,
        번호2: d.drwtNo2,
        번호3: d.drwtNo3,
        번호4: d.drwtNo4,
        번호5: d.drwtNo5,
        번호6: d.drwtNo6,
        보너스: d.bnusNo,
        당첨자수: d.firstPrzwnerCo,
        금액: d.firstWinamnt
    };

    showTable(latestData);
    localStorage.setItem("latestLotto", JSON.stringify(latestData));
}

// 테이블 표시
function showTable(data) {
    const table = document.getElementById("resultTable");
    const tbody = table.querySelector("tbody");
    tbody.innerHTML = "";

    const row = document.createElement("tr");
    Object.values(data).forEach(v => {
        const td = document.createElement("td");
        td.textContent = v;
        row.appendChild(td);
    });

    tbody.appendChild(row);
    table.style.display = "table";
}

// CSV 저장
function saveCSV() {
    if (!latestData) {
        alert("먼저 데이터를 가져오세요.");
        return;
    }

    const headers = Object.keys(latestData).join(",");
    const values = Object.values(latestData).join(",");
    const csv = headers + "\n" + values;

    const blob = new Blob([csv], { type: "text/csv" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "lotto_latest.csv";
    a.click();
}

// 페이지 로드 시 저장된 데이터 불러오기
window.onload = () => {
    const saved = localStorage.getItem("latestLotto");
    if (saved) {
        latestData = JSON.parse(saved);
        showTable(latestData);
    }
};
</script>

</body>
</html>