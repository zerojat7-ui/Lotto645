<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>로또 최신 결과</title>
<style>
body { font-family: sans-serif; padding: 20px; }
.ball { display:inline-block; width:40px; height:40px; line-height:40px;
        border-radius:50%; background:#f2f2f2; margin:5px; text-align:center; }
</style>
</head>
<body>

<h2>로또 최신 결과</h2>
<div id="result">불러오는 중...</div>
<button onclick="saveCSV()">CSV 저장</button>

<script>
async function loadLotto() {
  const url = "https://www.dhlottery.co.kr/gameResult.do?method=byWin";

  const res = await fetch(url);
  const html = await res.text();

  const parser = new DOMParser();
  const doc = parser.parseFromString(html, "text/html");

  const balls = [...doc.querySelectorAll(".ball_645.lrg")].map(v => v.textContent.trim());
  const round = doc.querySelector("strong")?.textContent.match(/[0-9]+/)[0];

  if (!balls.length) {
    document.getElementById("result").textContent = "데이터 추출 실패";
    return;
  }

  window.lottoData = {
    round,
    numbers: balls.slice(0,6),
    bonus: balls[6]
  };

  document.getElementById("result").innerHTML =
    `<h3>${round}회</h3>` +
    lottoData.numbers.map(n => `<span class="ball">${n}</span>`).join("") +
    ` + <span class="ball">${lottoData.bonus}</span>`;
}

function saveCSV() {
  if (!window.lottoData) return alert("먼저 불러오기");

  const d = lottoData;
  const csv =
    "회차,번호1,번호2,번호3,번호4,번호5,번호6,보너스\n" +
    `${d.round},${d.numbers.join(",")},${d.bonus}`;

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "lotto.csv";
  a.click();
}

loadLotto();
</script>

</body>
</html>